[gcode_macro HEAT_SOAK]
description: Heats bed for specified time and temperature
variable_target_temp: 65   # Target bed temperature for soaking
variable_soak_time: 60    # Soak time in seconds (30 minutes)
gcode:
    # Optionally home if your setup requires it:
    # G28

    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={target_temp}
    M117 Heating bed to {target_temp}C...
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={target_temp}

    M117 Heat soak for {soak_time|int} seconds...
    G4 P{soak_time}

    M117 Heat soak complete!


# Copyright (C) 2022 Justin Schuh <code@justinschuh.com>
#
# This file may be distributed under the terms of the GNU GPLv3 license.

; An idea for using the heated bed of a 3D printer as a filament dryer.
; Adds GCODE command: START_DRYER TIME=T TEMPERATURE=C
; (T is time in seconds, C is bed temperature in Celsuis)
; To stop drying early, use STOP_DRYER.
; Also defined some utility macros: DRY_PLA, DRY_PETG and DRY_ABS.
; Edit these with your own preferred defaults.

[gcode_macro DRY_FILAMENT]
description: Dry filament based on type and user-specified time.
variable_parameter_FILAMENT_TYPE: ABS, ASA, PETG, TPU, PC, Nylon, PVA
gcode:
    # Filament-Specific Settings (Modify per your dryer & preferences)
    {% set settings = {
        'ABS':   {'temp': 85,  'time': 28800},   # 80-90°C, 8 hours
        'ASA':   {'temp': 85,  'time': 28800},   # Same as ABS
        'PETG':  {'temp': 65,  'time': 14400},   # 60-70°C, 4 hours
        'TPU':   {'temp': 50,  'time': 7200},    # 45-55°C, 2 hours (adjust as needed)
        'PC':    {'temp': 90,  'time': 28800},   # 80-100°C, 8 hours (adjust as needed)
        'Nylon': {'temp': 85,  'time': 43200},   # 80-90°C, 12 hours (adjust as needed)
        'PVA':   {'temp': 0,   'time': 0}        # PVA should not be dried
    }%}

    # Input Validation
    {% set filament = params.FILAMENT_TYPE.upper() %}
    {% if filament not in settings %}
        RESPOND MSG="Invalid filament type: {filament}. Options are: ABS, ASA, PETG, TPU, PC, Nylon, PVA"
        return
    {% endif %}

    {% if filament == 'PVA' %}
        RESPOND MSG="PVA should not be dried!"
        return
    {% endif %}

    # Dryer Setup (Replace with your dryer's commands)
    SET_DRYER_TEMPERATURE CHAMBER={params.CHAMBER|25}
    SET_DRYER_TEMPERATURE TEMPERATURE={settings[filament]['temp']}

    # Drying Time (Override default if time is provided)
    {% set dry_time = params.TIME if 'TIME' in params else settings[filament]['time'] %}
    G4 P{dry_time}

    # Completion Message
    RESPOND MSG="{filament} filament drying complete!"